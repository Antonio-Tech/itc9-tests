# This file was generated using idf.py save-defconfig. It can be edited manually.
# Espressif IoT Development Framework (ESP-IDF) 5.3.1 Project Minimal Configuration
#
CONFIG_BOOTLOADER_LOG_LEVEL_WARN=y
CONFIG_BOOTLOADER_COMPILER_OPTIMIZATION_PERF=y
CONFIG_ESPTOOLPY_FLASHSIZE_8MB=y
CONFIG_PARTITION_TABLE_CUSTOM=y
CONFIG_PARTITION_TABLE_CUSTOM_FILENAME="partitions_cli.csv"
CONFIG_USE_AFE=n
CONFIG_USE_WAKENET=n
CONFIG_USE_MULTINET=n
# CONFIG_COMPILER_OPTIMIZATION_SIZE is not set
CONFIG_COMPILER_OPTIMIZATION_PERF=y
CONFIG_BT_ENABLED=y
CONFIG_BT_BLUEDROID_ENABLED=y
CONFIG_BT_CLASSIC_ENABLED=y
CONFIG_BT_A2DP_ENABLE=y
# CONFIG_BT_SPP_ENABLED=n
CONFIG_BT_BLE_ENABLED=y
CONFIG_BTDM_CTRL_MODE_BTDM=y
CONFIG_SPIRAM=y
CONFIG_SPIRAM_TRY_ALLOCATE_WIFI_LWIP=y
CONFIG_SPIRAM_ALLOW_BSS_SEG_EXTERNAL_MEMORY=y
CONFIG_SPIRAM_ALLOW_NOINIT_SEG_EXTERNAL_MEMORY=y
CONFIG_SPIRAM_ALLOW_STACK_EXTERNAL_MEMORY=y
# Reduced from 128KB to 32KB - saves 96KB DMA (we have 4MB PSRAM)
CONFIG_SPIRAM_MALLOC_RESERVE_INTERNAL=32768
CONFIG_ESP_SYSTEM_EVENT_TASK_STACK_SIZE=3072
CONFIG_ESP_MAIN_TASK_STACK_SIZE=8192
CONFIG_ESP_MAIN_TASK_AFFINITY_CPU0=y
CONFIG_ESP_MAIN_TASK_AFFINITY=0x0
CONFIG_FATFS_LFN_HEAP=y
CONFIG_FATFS_CODEPAGE_936=y
CONFIG_FATFS_FS_LOCK=20
CONFIG_FREERTOS_ENABLE_BACKWARD_COMPATIBILITY=y
CONFIG_FREERTOS_TIMER_TASK_STACK_DEPTH=4096
CONFIG_FREERTOS_GENERATE_RUN_TIME_STATS=y
CONFIG_FREERTOS_RUN_TIME_STATS_USING_CPU_CLK=y
CONFIG_FREERTOS_PLACE_FUNCTIONS_INTO_FLASH=y
CONFIG_LV_USE_PNG=y
CONFIG_LV_FONT_CUSTOM=y
CONFIG_LV_FONT_CUSTOM_DECLARE="fonts/cherry_bomb_fonts.h"
CONFIG_LV_CONF_SKIP=n
CONFIG_LV_COLOR_CHROMA_KEY_HEX=0xff00ff
CONFIG_LV_FONT_MONTSERRAT_12=y
CONFIG_LV_FONT_DEFAULT_MONTSERRAT_16=y
CONFIG_LV_LABEL_LONG_TXT_HINT=n
CONFIG_LV_USE_KEYBOARD=n
CONFIG_LV_USE_LED=n
CONFIG_LV_USE_LIST=n
CONFIG_LV_USE_MSGBOX=n
CONFIG_LV_USE_SPAN=n
CONFIG_LV_USE_SPINBOX=n
CONFIG_LV_USE_SPINNER=n
CONFIG_LV_USE_TABVIEW=n
CONFIG_LV_USE_TILEVIEW=n
CONFIG_LV_USE_WIN=n
CONFIG_LV_USE_GIF=y
CONFIG_LV_USE_QRCODE=y
CONFIG_LV_BUILD_EXAMPLES=n
CONFIG_IDF_EXPERIMENTAL_FEATURES=y
# CONFIG_ESP_DEFAULT_CPU_FREQ_MHZ_160 is not set
CONFIG_ESP_DEFAULT_CPU_FREQ_MHZ_240=y
CONFIG_ESP_DEFAULT_CPU_FREQ_MHZ=240
CONFIG_ESP_TASK_WDT_EN=n

CONFIG_ESP_WIFI_SOFTAP_SAE_SUPPORT=n
CONFIG_BT_ACL_CONNECTIONS=1
# DEPRECATED - replaced with BT_ALLOCATION_FROM_SPIRAM_FIRST
# CONFIG_BT_BLUEDROID_MEM_USE_PSRAM=y
CONFIG_BT_BLE_DYNAMIC_ENV_MEMORY=y
CONFIG_BT_ALLOCATION_FROM_SPIRAM_FIRST=y
CONFIG_BTDM_CTRL_PINNED_TO_CORE_1=y
CONFIG_BTDM_CTRL_PINNED_TO_CORE=1
# A2DP Performance: Restore stack size but move to PSRAM (no DMA impact)
CONFIG_BT_BTU_TASK_STACK_SIZE=8192
# Fixing warning: CONFIG_BLUEDROID_* was replaced with CONFIG_BT_BLUEDROID_* 
CONFIG_BT_BLUEDROID_PINNED_TO_CORE_1=y
CONFIG_BT_BLUEDROID_PINNED_TO_CORE=1
CONFIG_BTDM_CTRL_MODEM_SLEEP=n
CONFIG_BTDM_RESERVE_DRAM=0x10000
CONFIG_ULP_COPROC_ENABLED=y
CONFIG_ULP_COPROC_TYPE_FSM=y
CONFIG_ULP_COPROC_RESERVE_MEM=512
CONFIG_ESP_PHY_INIT_DATA_IN_PARTITION=y
CONFIG_ESP_PHY_DEFAULT_INIT_IF_INVALID=y
CONFIG_ESP_PHY_REDUCE_TX_POWER=y
# mbedTLS
CONFIG_MBEDTLS_EXTERNAL_MEM_ALLOC=y
CONFIG_FREERTOS_VTASKLIST_INCLUDE_COREID=y
CONFIG_FREERTOS_GENERATE_RUN_TIME_STATS=y

# wifi - Reduced buffer configuration for DMA conservation (Quick Win from baseline)
# Reduces WiFi DMA usage by ~45KB: RX 36->16 saves ~32KB, TX 16->8 saves ~13KB
# CRITICAL: Keep these values to prevent DMA exhaustion (72%->92% with WiFi would crash at 95%)
CONFIG_ESP_WIFI_STATIC_RX_BUFFER_NUM=12
CONFIG_ESP_WIFI_DYNAMIC_RX_BUFFER_NUM=48
CONFIG_ESP_WIFI_DYNAMIC_TX_BUFFER_NUM=16
CONFIG_ESP_WIFI_AMPDU_TX_ENABLED=y
CONFIG_ESP_WIFI_AMPDU_RX_ENABLED=y
CONFIG_ESP_WIFI_RX_BA_WIN=24
CONFIG_ESP_WIFI_TX_BA_WIN=8
CONFIG_ESP_WIFI_IRAM_OPT=n
CONFIG_ESP_WIFI_EXTRA_IRAM_OPT=n
CONFIG_ESP_WIFI_RX_IRAM_OPT=n

CONFIG_LWIP_IPV6=n
CONFIG_LWIP_TCP_SND_BUF_DEFAULT=65534
CONFIG_LWIP_TCP_WND_DEFAULT=65535
CONFIG_LWIP_TCP_RECVMBOX_SIZE=64
CONFIG_LWIP_TCPIP_RECVMBOX_SIZE=64

CONFIG_LWIP_IRAM_OPTIMIZATION=y
CONFIG_LWIP_TCPIP_TASK_PRIO=23

CONFIG_ESP_MAIN_TASK_AFFINITY_CPU0=y
CONFIG_ESP_MAIN_TASK_AFFINITY=0x0
CONFIG_PARTITION_TABLE_OFFSET=0xe000


#CONFIG_BOOTLOADER_LOG_LEVEL_NONE=y
CONFIG_SPIRAM_MEMTEST=n

# BLE
CONFIG_BTDM_CTRL_MODE_BTDM=y
CONFIG_BTDM_CTRL_BLE_MAX_CONN=1
CONFIG_BT_BLE_50_FEATURES_SUPPORTED=n
CONFIG_BT_BLE_42_FEATURES_SUPPORTED=y

CONFIG_BT_BLE_ENABLED=y
CONFIG_BT_GATTS_ENABLE=y

# A2DP Performance: Increase BTC stack in PSRAM (no DMA impact)
CONFIG_BT_BTC_TASK_STACK_SIZE=8192


# optmizations
CONFIG_LWIP_MAX_SOCKETS=6
CONFIG_LWIP_UDP_RECVMBOX_SIZE=64

CONFIG_RINGBUF_PLACE_FUNCTIONS_INTO_FLASH=y
CONFIG_RINGBUF_PLACE_ISR_FUNCTIONS_INTO_FLASH=n
CONFIG_ESP_EVENT_POST_FROM_IRAM_ISR=y
CONFIG_HEAP_PLACE_FUNCTION_INTO_FLASH=y

# Keep critical libs in IRAM for SDMMC stability during WiFi/BLE operations
CONFIG_SPIRAM_CACHE_LIBIO_IN_IRAM=n
CONFIG_SPIRAM_CACHE_LIBSTR_IN_IRAM=n
CONFIG_SPIRAM_CACHE_LIBFILE_IN_IRAM=n
CONFIG_SPIRAM_CACHE_LIBTIME_IN_IRAM=n
CONFIG_SPIRAM_CACHE_LIBMATH_IN_IRAM=n
CONFIG_SPIRAM_CACHE_LIBJMP_IN_IRAM=n
CONFIG_SPIRAM_CACHE_LIBNUMPARSER_IN_IRAM=n
CONFIG_SPIRAM_CACHE_LIBCHAR_IN_IRAM=n
CONFIG_SPIRAM_CACHE_LIBMEM_IN_IRAM=n

CONFIG_FREERTOS_VTASKLIST_INCLUDE_COREID=y

CONFIG_NEWLIB_NANO_FORMAT=y

# ============================================================================
# A2DP PERFORMANCE OPTIMIZATIONS (DMA-safe)
# ============================================================================

# NOTE: Task stack in PSRAM options do not exist in ESP-IDF v4.4.5
# BT tasks will use regular memory allocation as configured by BT_ALLOCATION_FROM_SPIRAM_FIRST

# ============================================================================
# A2DP PERFORMANCE OPTIMIZATIONS (CPU optimizations, no DMA impact)
# ============================================================================

# Reduce Bluetooth Classic connections for better performance
CONFIG_BT_ACL_CONNECTIONS=1
CONFIG_BTDM_CTRL_BR_EDR_MAX_SYNC_CONN=0

# GATT Server profiles optimization
# CONFIG_BT_GATT_MAX_SR_PROFILES=1 - REMOVED: Causes "no free handle blocks" error during BLE init
# Default value (8) allows BLE manager to create all required services

# Reduce Bluetooth timers and intervals for better performance
CONFIG_BTDM_CTRL_FULL_SCAN_SUPPORTED=n
CONFIG_BTDM_CTRL_HCI_MODE_VHCI=y

# Bluetooth memory optimizations (PSRAM usage, no DMA impact)
CONFIG_BTDM_CTRL_MODE_BTDM=y

# Coexistence for BLE+WiFi (A2DP will disable WiFi completely)
CONFIG_ESP_COEX_SW_COEXIST_ENABLE=y
CONFIG_ESP_COEX_EXTERNAL_COEXIST_ENABLE=n

# NOTE: Custom flags removed - not part of ESP-IDF configuration system
# Dynamic resource management should be handled in application code

# ============================================================================
# A2DP AUDIO PERFORMANCE OPTIMIZATIONS
# ============================================================================

# A2DP SBC codec now uses 32kHz sample rate (changed in bluedroid bta_av_co.c)
# This provides ~27% CPU reduction and faster BT/WiFi switching

# Bluetooth GAP optimizations for A2DP performance
CONFIG_BT_BLE_RPA_TIMEOUT=30
# Scan duplicate filtering configuration (corrected symbol name)
CONFIG_BTDM_SCAN_DUPL_TYPE=0

# user mode for performance
CONFIG_USER_MODE=n


CONFIG_ESP32_RTC_CLK_SRC_EXT_CRYS=y
CONFIG_ESP32_RTC_CLOCK_SOURCE_EXTERNAL_CRYSTAL=y
CONFIG_ESP32_RTC_EXT_CRYST_ADDIT_CURRENT_NONE=y
